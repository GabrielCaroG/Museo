<!-- Librería de A-Frame -->
<script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

<a-scene xr-mode-ui="enabled: true" vr-mode-ui="enabled: true">
  <!-- ===========================================
       📌 ASSETS
  ============================================ -->
  <a-assets>
    <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
    <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg">
  </a-assets>

  <!-- ===========================================
       📌 CÁMARA Y RIG DEL JUGADOR
  ============================================ -->
  <a-entity id="rig" position="0 1.6 0" joystick-movement>
    <!-- Cámara principal con controles -->
    <a-entity 
      id="playerCamera"
      camera
      wasd-controls
      look-controls="pointerLockEnabled: true"
      position="0 0 0">
      
      <!-- Luz anclada al observador -->
      <a-entity 
        light="type: point; color: #ffffff; intensity: 5; distance: 7.5">
      </a-entity>
    </a-entity>

    <!-- Controladores VR -->
    <a-entity id="leftHand" oculus-touch-controls="hand: left"></a-entity>
    <a-entity id="rightHand" oculus-touch-controls="hand: right"></a-entity>
  </a-entity>

  <!-- ===========================================
       📌 ENTORNO
  ============================================ -->
  <a-cylinder 
    id="ground" 
    src="#groundTexture" 
    radius="175" 
    height="0.1">
  </a-cylinder>

  <a-sky 
    id="background" 
    src="#skyTexture" 
    theta-length="90" 
    radius="175">
  </a-sky>

  <!-- ===========================================
       📌 LUCES
  ============================================ -->
  <a-entity id="lights"></a-entity>

  <!-- Luz direccional (como el sol) -->
  <a-entity 
    light="type: directional; color: #ffffff; intensity: 0.8; castShadow: true"
    position="0 10 5"
    rotation="-45 0 0">
  </a-entity>

  <!-- ===========================================
       📌 MODELOS 3D
  ============================================ -->
  <a-entity
    gltf-model="https://raw.githubusercontent.com/GabrielCaroG/modelo3d/main/Museo.glb"
    position="0 0 -3"
    scale="1 1 1"
    rotation="0 0 0">
  </a-entity>
</a-scene>

<script>
  // Componente para capturar el joystick de los mandos de Quest
  AFRAME.registerComponent('joystick-movement', {
    tick: function () {
      const rig = this.el;
      const left = rig.querySelector('#leftHand').components['oculus-touch-controls'];
      const right = rig.querySelector('#rightHand').components['oculus-touch-controls'];

      if (left && left.controller && left.controller.gamepad) {
        const [x, y] = left.controller.gamepad.axes; // joystick izquierdo
        rig.object3D.position.x -= x * 0.1;
        rig.object3D.position.z -= y * 0.1;
      }

      if (right && right.controller && right.controller.gamepad) {
        const [rx] = right.controller.gamepad.axes; // joystick derecho X
        rig.object3D.rotation.y -= rx * 0.05;
      }
    }
  });
</script>
